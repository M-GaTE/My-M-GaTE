{# layout d'accueil pour les études  #}

{% extends "mgateSuiviBundle::layout.html.twig" %}

{% block title %}
Accueil - {{ parent() }}
{% endblock %}

{% block content_bundle %}

<div class="tabbable"> <!-- Only required for left/right tabs -->
    <ul class="nav nav-tabs">
        {#% if etudesSuiveur | length %}
        <li class="active"><a href="#tab1" data-toggle="tab">Etudes à suivre ({{app.user.personne.prenomnom|default('non connecté')}})</a></li>
        {% endif %#}
        <li class="active"><a href="#tab2" data-toggle="tab">Etudes en Négociation ({{ etudesEnNegociation | length }})</a></li>
        <li><a href="#tab3" data-toggle="tab">Etudes en Cours ({{ etudesEnCours | length }})</a></li>
        {% if etudesEnPause | length %}
        <li><a href="#tab4" data-toggle="tab">Etudes en Pause ({{ etudesEnPause | length }})</a></li>
        {% endif %}
        <li><a href="#tab5" data-toggle="tab">Etudes Terminées</a></li>
        <li><a href="#tab6" data-toggle="tab">Etudes Avortées</a></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="tab2" style="min-height: 400px;">
            {% include "mgateSuiviBundle:Etude:Tab/EtudesEnNegociation.html.twig" with  {'etudesEnNegociation':  etudesEnNegociation} %}
        </div>
        <div class="tab-pane" id="tab3" style="min-height: 400px;">
            {% include "mgateSuiviBundle:Etude:Tab/EtudesEnCours.html.twig" with  {'etudesEnCours':  etudesEnCours} %}
        </div>
        {% if etudesEnPause | length %}
        <div class="tab-pane" id="tab4" style="min-height: 400px;">
            {% include "mgateSuiviBundle:Etude:Tab/EtudesEnPause.html.twig" with  {'etudesEnPause':  etudesEnPause} %}
        </div>
        {% endif %}
        <div class="tab-pane" id="tab5" style="min-height: 400px;">
            Chargement en cours
        </div>
        <div class="tab-pane" id="tab6" style="min-height: 400px;">
            Chargement en cours
        </div>
    </div>


{% endblock %}
            
{% block javascript %}
{{ parent() }}
    <script src="{{ asset('js/bootboxjs.js')}}"></script>
    
    
    <script>
    //ajax for etudes loading
    $(document).ready(function() {
        
        var alreadyLoaded = "";
        
        //listen for tab change
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var tab = e.target.href.substring(e.target.href.indexOf('#')+1); // activated tabv
            
            console.log(document.getElementById(tab).textContent.length);
            
            //Check if already loaded
            if(!alreadyLoaded.indexOf(tab)!=-1)
            {
                alreadyLoaded+=tab;
                var select;

                if(tab == "tab5")
                    select="etudesTermineesParMandat";
                else if(tab == "tab6")
                    select="etudesAvorteesParMandat";
                else
                    return;

                var url = "{{path('mgateSuivi_etude_getetudes', {'select': 'selectValue'})}}";
                url=url.replace("selectValue", select);

                $(".loading").show();

                //Request and display
                var xmlHttp = null;
                xmlHttp = new XMLHttpRequest();
                xmlHttp.open( "GET", url, false );
                xmlHttp.send( null );
                document.getElementById(tab).innerHTML = xmlHttp.responseText;

                $(".loading").hide();
            }
            
        })
    });
    </script>
{% endblock %}