{% extends "mgateSuiviBundle::layout.html.twig" %}
{% set valide    = asset('img/succes.png') %}
{% set nonValide = asset('img/cross.png') %}
{% set enCours   = asset('img/progress.png') %}
{% block menu %}
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <a class="brand" href="{{ path('mgateSuivi_etude_voir', {'id': etude.id}) }}">{{ getRefEtude(etude) }} - {{ etude.nom }}</a>
        <ul class="nav pull-right">
            <li>
                <li><a href="{{ path('mgateSuivi_vu_ca', {'id': prevID}) }}">Prev</a></li>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li class="nav-header">Nav header</li>
                    <li><a href="#">Separated link</a></li>
                    <li><a href="#">One more separated link</a></li>
                </ul>
            </li>
            <li><a href="{{ path('mgateSuivi_vu_ca', {'id': nextID}) }}">Next</a></li>
        </ul>


    </div>

</div>
            {% endblock %}
{% block breadcrumb %}
{% endblock %}


{% block content %}
<table>
    <tr>
        <td>
            <table class="table table-bordered table-striped" style="padding-top: 0px;">
                <tr class="{{ (etude.stateID == 1 ? "info" : (etude.stateID == 2 ? "success" : (etude.stateID == 3 ? "warning" : (etude.stateID == 4 ? "" : "error")))) }}">
                    <td><h5>Etat : {{ (etude.stateID == 4 ? "Terminée" : (etude.stateID == 5 ? "Avortée" : (etude.stateID == 3 ? "En Pause" : (etude.stateID == 2 ? "En Cours" : "En négociation")))) }}</h5></td>
                    <td colspan="3">{{ etude.stateDescription }}</td>
                </tr>
                <tr>
                    <th>Client</th>
                    <td>{% include "mgateSuiviBundle:Etude:Buttons/Prospect.html.twig" with  {'prospect':  etude.prospect} %}</td>
                    <th>Suiveur</th>
                    <td>{% include "mgateSuiviBundle:Etude:Buttons/Suiveur.html.twig" with  {'suiveur':  etude.suiveur} %}</td>
                </tr>
                <tr>
                    <td colspan="4" style=" text-align: center !important; ">
                    {% for mission in etude.missions %}
                {% include "mgateSuiviBundle:Etude:Buttons/Intervenant.html.twig" with  {'idEtude':  etude.id, 'intervenant' : mission.intervenant, 'keyMission' : loop.index0 } %}
                    {% if loop.index != loop.last %}
                            &nbsp;
                    {% endif %}



    {% endfor %}
                        </td>
                    </tr>
                    <tr>
                        <th>Création</th>
                        <td>Crée le {{ etude.dateCreation|date("d/m/Y") }}</td>
                        <th>Fin</th>
                        <td>Fin le {{ getDateFin(etude)|date("d/m/Y") }}</td>
                    </tr>
                    <tr>
                        <th>JEH</th>
                        <td>{{getNbrJEH(etude) | default('0') }} JEH</td>
                        <th>Prix</th>
                        <td>{{ getTotalHT(etude) | default('0') }} € HT</td>
                    </tr>
                    <tr>
                        <th>Description</th>
                        <td colspan="3">{{etude.description }}</td>
                    </tr>
                </table>
            </td>
            <td>
                <table class="table table-bordered table-striped">
                    <tr>
                        <th colspan="2">Dernier Contact</th>
                        <td colspan="2">
            {% set dernierContact = 0 %}
            {% set derniercontactObject = null %}
            {% for contact in etude.clientContacts%}
                    {% set dernierContact = dernierContact | date("U") < contact.date |date("U") ? contact.date : dernierContact %}
                    {% set derniercontactObject = dernierContact | date("U") < contact.date |date("U") ? contact : derniercontactObject %}
            {% endfor %}
                            {% set dCU = dernierContact | date("U") %}
                                <span class="badge badge-{{ (dernierContact | date("dmy")) == ("now" | date("dmy")) ? "info" : (dCU > "now"|date("U") ? "important" : ( dCU > "now" |date_modify("-5 day")|date("U") ? "success" : (dCU > "now" |date_modify("-10 day")|date("U") ? "warning" : "important"))) }}">
                    {{ dernierContact | date("d/m/Y") == "01/01/1970" ? "Jamais" : dernierContact | date("d/m/Y") }}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>AP</th>
                                <th>CC</th>
                                <th>FA</th>
                                <th>RM</th>
                            </tr>
                            <tr>
                                <td>
        {% if getEtatDoc(etude.ap) == 1 %}
                                        <img src="{{ enCours }}" />
        {% elseif getEtatDoc(etude.ap) == 2 %}
                                        <img src="{{ valide }}" />
        {% else %}
                                        <img src="{{ nonValide }}" />
        {% endif %}
                                    </td>

                                    <td>
        {% if getEtatDoc(etude.cc) == 1 %}
                                            <img src="{{ enCours }}" />
        {% elseif getEtatDoc(etude.cc) == 2 %}
                                            <img src="{{ valide }}" />
        {% else %}
                                            <img src="{{ nonValide }}" />
        {% endif %}
                                        </td>
                                        <td>
        {% if getEtatDoc(etude.fa) == 1 %}
                                                <img src="{{ enCours }}" />
        {% elseif getEtatDoc(etude.fa) == 2 %}
                                                <img src="{{ valide }}" />
        {% else %}
                                                <img src="{{ nonValide }}" />
        {% endif %}
                                            </td>
                                            <td>
                                        {% for mission in etude.missions %}
            {% if getEtatDoc(mission) == 1 %}
                                                    <img title="{{mission.intervenant.personne.prenomNom | default("")}}" src="{{ enCours }}" />
            {% elseif getEtatDoc(mission) == 2 %}
                                                    <img title="{{mission.intervenant.personne.prenomNom | default("")}}" src="{{ valide }}" />
            {% else %}
                                                    <img title="{{mission.intervenant.personne.prenomNom | default("")}}" src="{{ nonValide }}" />
        {% endif %}
                                                    &nbsp;
        {% endfor %}
                                                </td>
                                            </tr>
                                            <!--<tr>
                                                <th colspan="4">Avancement</th>
                                            </tr>
                                            <tr>
                                                <td colspan="4">
                                                    <div class="progress">
                                                        <div class="bar" style="width: {{ 0 ~ '%;'|default('0%;') }}"></div>
                                                    </div>
                                                </td>                                    
                                            </tr>-->
                                            <tr>
                                                <th>PVR</th>
                                                <th>FS</th>
                                                <th>RP</th>
                                                <th>BV</th>
                                            </tr>
                                            <tr>
                                                <td>
        {% if getEtatDoc(etude.pvr) == 1 %}
                                                        <img src="{{ enCours }}" />
        {% elseif getEtatDoc(etude.pvr) == 2 %}
                                                        <img src="{{ valide }}" />
        {% else %}
                                                        <img src="{{ nonValide }}" />
        {% endif %}
                                                    </td>
                                                    <td>
        {% if getEtatDoc(etude.fs) == 1 %}
                                                            <img src="{{ enCours }}" />
        {% elseif getEtatDoc(etude.fs) == 2 %}
                                                            <img src="{{ valide }}" />
        {% else %}
                                                            <img src="{{ nonValide }}" />
        {% endif %}
                                                        </td>
                                                        <td>

                                                        </td>
                                                        <td>

                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                    <td style="padding-left: 20px; width: 75%;" valign="top">
                                        <div id="linechart" style="width: 100%;"></div>
                                        <!--<div class="gantt" id="ganttId0"></div>-->
                                    </td>

{% endblock %}

{% block javascript %}
{{ parent() }}
                                    <script src="{{ asset('bundles/obhighcharts/js/highcharts/highcharts.js') }}"></script>
                                    <script src="{{ asset('bundles/obhighcharts/js/highcharts/modules/exporting.js') }}"></script>
                                    <script src="{{ asset('js/hightcharts.js') }}"></script>
                                    <script type="text/javascript">
                                        {{ chart(chart) }}
                                        </script>
{% endblock %}